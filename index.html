<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Shortener</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
     <style>
        body { padding: 20px; }
        #shortenedUrl { margin-top: 1em; }
         .shortener-container {
            max-width: 600px;
            margin: 0 auto;
        }

         .modal-card-body { padding: 1.5rem;}
         .is-hidden {display: none;}
         #err {margin-top: 0.5em;}
     </style>
</head>
<body>
    <section class="section">
        <div class="container shortener-container">
            <h1 class="title has-text-centered">URL Shortener</h1>

            <div class="field">
                <label class="label">Long URL:</label>
                <div class="control">
                    <input id="urlInput" class="input" type="text" placeholder="Enter URL to shorten">
                </div>
            </div>

            <div class="field">
                <div class="control">
                    <button id="shortenButton" class="button is-primary is-fullwidth">Shorten</button>
                </div>
            </div>

          <p id="err" class="help is-danger"></p>

           <div id="shortUrlModal" class="modal">
                <div class="modal-background"></div>
                <div class="modal-card">
                    <header class="modal-card-head">
                        <p class="modal-card-title">Shortened URL</p>
                        <button class="delete" aria-label="close"></button>
                    </header>
                    <section class="modal-card-body has-text-centered">
                        <p id="modalShortUrl"></p>
                        <button id="copyButton" class="button is-info is-small"><i class="fas fa-copy"></i> Copy</button>
                    </section>
                  </div>
              </div>
        </div>
    </section>


    <script>
        const getUrl = () => {
            const urlInput = document.getElementById("urlInput");
            if (!urlInput) return null;
            let url = urlInput.value.trim();
            if (!url) return null;
            const protocolOk = url.startsWith("http://") || url.startsWith("https://") || url.startsWith("ftp://");
            return protocolOk ? url : "http://" + url;
        };

        const getRandom = () => {
            let text = "";
            const possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
            for (let i = 0; i < 5; i++) {
                text += possible.charAt(Math.floor(Math.random() * possible.length));
            }
            return text;
        };

        const generateShortCode = () => {
            let shortCode;
            do {
                shortCode = getRandom();
            } while (localStorage.getItem(shortCode));
            return shortCode;
        };

       const displayModal = (shortUrl) => {
           const modal = document.getElementById('shortUrlModal');
           const modalShortUrl = document.getElementById('modalShortUrl');
            modalShortUrl.innerHTML = `<a href="${shortUrl}" target="_blank">${shortUrl}</a>`;
           modal.classList.add('is-active');


            const closeModalButton = modal.querySelector('.delete');
            closeModalButton.addEventListener('click', () => {
                 modal.classList.remove('is-active');
             });

        const copyButton = document.getElementById('copyButton');
        copyButton.addEventListener('click', () => {
        navigator.clipboard.writeText(shortUrl)
                .then(() => {
                    copyButton.innerHTML = `<i class="fas fa-check"></i> Copied!`;
                    setTimeout(() => {
                            copyButton.innerHTML = `<i class="fas fa-copy"></i> Copy`;
                      }, 1500);
                    })
                .catch(err => {
                    console.error('Failed to copy: ', err);
                     copyButton.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Failed to copy`;
                  setTimeout(() => {
                            copyButton.innerHTML = `<i class="fas fa-copy"></i> Copy`;
                      }, 1500);
                });
            });
       };

       const displayError = (message) => {
              document.getElementById('err').innerHTML = message;
       };

        const shortenUrl = () => {
            const longUrl = getUrl();
            if (!longUrl) {
                displayError("Please enter a valid URL.");
               return;
             }

              displayError("");
            const shortCode = generateShortCode();
            localStorage.setItem(shortCode, longUrl);
            const shortUrl = window.location.origin + window.location.pathname + "#" + shortCode;
           displayModal(shortUrl);
        };

        const handleRedirect = () => {
           const hash = window.location.hash.substring(1);
             if (hash) {
                const longUrl = localStorage.getItem(hash);
                 if (longUrl) {
                   window.location.replace(longUrl);
                  } else {
                    displayError("URL Not found.");
                 }
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById("shortenButton").addEventListener("click", shortenUrl);
            handleRedirect();
         });
    </script>
</body>
</html>